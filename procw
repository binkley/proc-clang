#!/usr/bin/env bash

set -e
set -o pipefail

: "${ICLIBHOME:?ICLIBHOME undefined}"
export LD_LIBRARY_PATH=$ICLIBHOME:$LD_LIBRARY_PATH

# Emulate proc behavior w.r.t. source file
for arg
do
    case $arg in
    *=* ) case ${arg%%=*} in
        [iI][nN][aA][mM][eE] ) source=${arg#*=} ; break ;;
        esac ;;
    * ) source=$arg ; break ;;
    esac
done

$ICSDKHOME/proc "$@" | sed 1,7d # | ex -c \
# '/^#include <stdarg.h>/
# .-1,.+2d
# x' -
# rm -f ${source%.pc}.lis
# 
# 'Error at line 3, column 10 in file mock-oracle.pc
# #include <stdarg.h>
# .........1
# PCC-S-02015, unable to open include file'
